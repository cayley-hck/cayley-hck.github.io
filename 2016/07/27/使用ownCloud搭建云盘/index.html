<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录前进的脚步"><title>使用ownCloud搭建云盘 | 凯旋</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用ownCloud搭建云盘</h1><a id="logo" href="/.">凯旋</a><p class="description">cayley的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用ownCloud搭建云盘</h1><div class="post-meta"><i class="fa fa-calendar"> 2016-07-27</i></div><span data-disqus-identifier="2016/07/27/使用ownCloud搭建云盘/" class="disqus-comment-count"></span><div class="post-content"><p>ownCloud:<br>    ownCloud是一个自由且开源的个人云存储解决方案(网盘)，包括两个部分：服务器和客户端。<br>ownCloud在客户端可通过网页界面，或者安装专用的客户端软件来使用。网页界面当然就是任何能打开网页的平台都支持，而客户端软件也支持相当多平台，Windows、Linux、iOS、Android皆有。<br>除了云存储之外，ownCloud也可用于同步行事历、电子邮件联系人、网页浏览器的书签；此外还有多人在线文件同步协作的功能。(维基百科).<br>    同时ownCloud使用php语言进行开发的,github地址:<a href="https://github.com/owncloud,官网地址" target="_blank" rel="external">https://github.com/owncloud,官网地址</a>: <a href="http://owncloud.org" target="_blank" rel="external">http://owncloud.org</a></p>
<p>安装:</p>
<p>1)前提</p>
<p>需要安装php &amp;&amp; http服务器软件.<br>这里我安装php7和nginx,具体安装方法请参考网上或者<php7和nignx一键安装脚本></php7和nignx一键安装脚本></p>
<p>需要安装mysql || mariadb<br>mariadb:是mysql的一个开源分支,兼容mysql.这里为了方便一下,直接用yum安装mariadb了<br>先搜索一下包:<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@niaoyun49026 libiconv-<span class="number">1.14</span>]# yum search mariadb</span><br><span class="line"><span class="preprocessor">#启动mariadb</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line"><span class="preprocessor">#可以设置为开机启动</span></span><br><span class="line">systemctl enable mariadb </span><br><span class="line"><span class="preprocessor">#设置 root密码等相关</span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#停止</span></span><br><span class="line">systemctl stop mariadb</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#测试登陆</span></span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></p>
<p>设置db密码等安全:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[root@niaoyun49026 libiconv-<span class="number">1.14</span>]<span class="preprocessor"># mysql_secure_installation </span></span><br><span class="line">/usr/bin/mysql_secure_installation: line <span class="number">379</span>: find_mysql_client: command <span class="keyword">not</span> found</span><br><span class="line"></span><br><span class="line">NOTE: RUNNING ALL PARTS <span class="keyword">OF</span> THIS SCRIPT <span class="keyword">IS</span> RECOMMENDED <span class="keyword">FOR</span> ALL MariaDB</span><br><span class="line">      SERVERS <span class="keyword">IN</span> PRODUCTION USE!  PLEASE READ <span class="keyword">EACH</span> <span class="keyword">STEP</span> CAREFULLY!</span><br><span class="line"></span><br><span class="line"><span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> log <span class="keyword">into</span> MariaDB <span class="keyword">to</span> secure it, we<span class="comment">'ll need the current</span></span><br><span class="line">password <span class="keyword">for</span> the root user.  <span class="keyword">If</span> you<span class="comment">'ve just installed MariaDB, and</span></span><br><span class="line">you haven<span class="comment">'t set the root password yet, the password will be blank,</span></span><br><span class="line">so you should just press enter here.</span><br><span class="line"></span><br><span class="line">Enter current password <span class="keyword">for</span> root (enter <span class="keyword">for</span> none): </span><br><span class="line"><span class="keyword">ERROR</span> <span class="number">1045</span> (<span class="number">28000</span>): Access denied <span class="keyword">for</span> user <span class="comment">'root'@'localhost' (using password: YES)</span></span><br><span class="line">Enter current password <span class="keyword">for</span> root (enter <span class="keyword">for</span> none): </span><br><span class="line">OK, successfully used password, moving <span class="keyword">on</span>...</span><br><span class="line"></span><br><span class="line">Setting the root password ensures that nobody can log <span class="keyword">into</span> the MariaDB</span><br><span class="line">root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> root password? [Y/n] y</span><br><span class="line"><span class="keyword">New</span> password: </span><br><span class="line">Re-enter <span class="keyword">new</span> password: </span><br><span class="line">Password updated successfully!</span><br><span class="line">Reloading privilege tables..</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">By</span> <span class="keyword">default</span>, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line"><span class="keyword">to</span> log <span class="keyword">into</span> MariaDB without having <span class="keyword">to</span> have a user account created <span class="keyword">for</span></span><br><span class="line">them.  This <span class="keyword">is</span> intended only <span class="keyword">for</span> testing, <span class="keyword">and</span> <span class="keyword">to</span> make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving <span class="keyword">into</span> a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] y</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Normally, root should only be allowed <span class="keyword">to</span> connect <span class="keyword">from</span> <span class="comment">'localhost'.  This</span></span><br><span class="line">ensures that someone cannot guess at the root password <span class="keyword">from</span> the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] </span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line"><span class="keyword">By</span> <span class="keyword">default</span>, MariaDB comes <span class="keyword">with</span> a database named <span class="comment">'test' that anyone can</span></span><br><span class="line">access.  This <span class="keyword">is</span> also intended only <span class="keyword">for</span> testing, <span class="keyword">and</span> should be removed</span><br><span class="line">before moving <span class="keyword">into</span> a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database <span class="keyword">and</span> access <span class="keyword">to</span> it? [Y/n] </span><br><span class="line"> - Dropping test database...</span><br><span class="line"> ... Success!</span><br><span class="line"> - Removing privileges <span class="keyword">on</span> test database...</span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will <span class="keyword">take</span> effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] </span><br><span class="line"> ... Success!</span><br><span class="line"></span><br><span class="line">Cleaning up...</span><br><span class="line"></span><br><span class="line">All done!  <span class="keyword">If</span> you<span class="comment">'ve completed all of the above steps, your MariaDB</span></span><br><span class="line">installation should now be secure.</span><br><span class="line"></span><br><span class="line">Thanks <span class="keyword">for</span> <span class="keyword">using</span> MariaDB!</span><br><span class="line">[root@niaoyun49026 libiconv-<span class="number">1.14</span>]<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>2)安装<br>先下载源码:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@niaoyun49026 data]<span class="preprocessor"># mkdir /data/codebase</span></span><br><span class="line">[root@niaoyun49026 data]<span class="preprocessor"># wget https:<span class="comment">//download.owncloud.org/community/owncloud-9.1.0.tar.bz2</span></span></span><br><span class="line">--<span class="number">2016</span>-<span class="number">07</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">11</span>--  https:<span class="comment">//download.owncloud.org/community/owncloud-9.1.0.tar.bz2</span></span><br><span class="line">Resolving download.owncloud.org (download.owncloud.org)... <span class="number">188.40</span><span class="number">.127</span><span class="number">.122</span>, <span class="number">148.251</span><span class="number">.209</span><span class="number">.106</span>, <span class="number">188.40</span><span class="number">.68</span><span class="number">.177</span>, ...</span><br><span class="line">Connecting to download.owncloud.org (download.owncloud.org)|<span class="number">188.40</span><span class="number">.127</span><span class="number">.122</span>|:<span class="number">443.</span>.. connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">29055490</span> (<span class="number">28</span>M) [application/x-bzip2]</span><br><span class="line">Saving to: wncloud-<span class="number">9.1</span><span class="number">.0</span>.tar.bz2</span><br><span class="line"><span class="number">2016</span>-<span class="number">07</span>-<span class="number">27</span> <span class="number">17</span>:<span class="number">44</span>:<span class="number">55</span> (<span class="number">21.0</span> KB/s) - wncloud-<span class="number">9.1</span><span class="number">.0</span>.tar.bz2saved [<span class="number">29055490</span>/<span class="number">29055490</span>]</span><br></pre></td></tr></table></figure></p>
<p>配置数据文件夹:<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#解压:</span></span><br><span class="line"><span class="title">tar</span> -xvf /<span class="typedef"><span class="keyword">data</span>/owncloud-9.1.0.tar.bz2 -<span class="type">C</span> /<span class="keyword">data</span>/codebase/</span></span><br><span class="line"><span class="preprocessor">#进入owncloud文件</span></span><br><span class="line"><span class="title">cd</span> /<span class="typedef"><span class="keyword">data</span>/codebase/owncloud</span></span><br><span class="line"><span class="preprocessor">#owncloud需要对apps、data、config目录有write的权限，要是没有这三个文件需要手动创建</span></span><br><span class="line"><span class="preprocessor">#由于wget下来的版本没有data，那么就来mkdir</span></span><br><span class="line"><span class="title">mkdir</span> <span class="typedef"><span class="keyword">data</span></span></span><br><span class="line"><span class="preprocessor">#分别给予write权限</span></span><br><span class="line"><span class="title">sudo</span> chown -<span class="type">R</span> www: www <span class="typedef"><span class="keyword">data</span></span></span><br><span class="line"><span class="title">sudo</span> chown -<span class="type">R</span>  www: www config</span><br><span class="line"><span class="title">sudo</span> chown -<span class="type">R</span>  www: www apps</span><br></pre></td></tr></table></figure></p>
<p> nginx配置:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> php-handler &#123;</span><br><span class="line">    <span class="title">server</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="comment">#server unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">    <span class="title">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="title">server_name</span> cloud.miaoxiaohei.com;</span><br><span class="line">    <span class="comment"># enforce https</span></span><br><span class="line">    <span class="title">return</span> <span class="number">301</span> <span class="url">https://<span class="variable">$server_name</span><span class="variable">$request_uri</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">    <span class="title">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="title">server_name</span> cloud.miaoxiaohei.com;</span><br><span class="line"></span><br><span class="line">    <span class="title">ssl_certificate</span> /data/ssl/cloud.miaoxiaohei.com.crt;</span><br><span class="line">    <span class="title">ssl_certificate_key</span> /data/ssl/cloud.miaoxiaohei.com.key;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add headers to serve security related headers</span></span><br><span class="line">    <span class="comment"># Before enabling Strict-Transport-Security headers please read into this topic first.</span></span><br><span class="line">    <span class="comment"># add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";</span></span><br><span class="line">    <span class="title">add_header</span> X-Content-Type-Options nosniff;</span><br><span class="line">    <span class="title">add_header</span> X-Frame-Options <span class="string">"SAMEORIGIN"</span>;</span><br><span class="line">    <span class="title">add_header</span> X-XSS-Protection <span class="string">"1; mode=block"</span>;</span><br><span class="line">    <span class="title">add_header</span> X-Robots-Tag <span class="built_in">none</span>;</span><br><span class="line">    <span class="title">add_header</span> X-Download-Options noopen;</span><br><span class="line">    <span class="title">add_header</span> X-Permitted-Cross-Domain-Policies <span class="built_in">none</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Path to the root of your installation</span></span><br><span class="line">    <span class="title">root</span> /data/codebase/owncloud/;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> = /robots.txt &#123;</span><br><span class="line">        <span class="title">allow</span> all;</span><br><span class="line">        <span class="title">log_not_found</span> <span class="built_in">off</span>;</span><br><span class="line">        <span class="title">access_log</span> <span class="built_in">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The following 2 rules are only needed for the user_webfinger app.</span></span><br><span class="line">    <span class="comment"># Uncomment it if you're planning to use this app.</span></span><br><span class="line">    <span class="comment">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span></span><br><span class="line">    <span class="comment">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json last;</span></span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> = /.well-known/carddav &#123;</span><br><span class="line">        <span class="title">return</span> <span class="number">301</span> <span class="variable">$scheme</span>://<span class="variable">$host</span>/remote.php/dav;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">location</span> = /.well-known/caldav &#123;</span><br><span class="line">        <span class="title">return</span> <span class="number">301</span> <span class="variable">$scheme</span>://<span class="variable">$host</span>/remote.php/dav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> /.well-known/acme-challenge &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># set max upload size</span></span><br><span class="line">    <span class="title">client_max_body_size</span> <span class="number">512M</span>;</span><br><span class="line">    <span class="title">fastcgi_buffers</span> <span class="number">64</span> <span class="number">4K</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Disable gzip to avoid the removal of the ETag header</span></span><br><span class="line">    <span class="title">gzip</span> <span class="built_in">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Uncomment if your server is build with the ngx_pagespeed module</span></span><br><span class="line">    <span class="comment"># This module is currently not supported.</span></span><br><span class="line">    <span class="comment"># pagespeed off;</span></span><br><span class="line"></span><br><span class="line">    <span class="title">error_page</span> <span class="number">403</span> /core/templates/<span class="number">403</span>.php;</span><br><span class="line">    <span class="title">error_page</span> <span class="number">404</span> /core/templates/<span class="number">404</span>.php;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> / &#123;</span><br><span class="line">        <span class="title">rewrite</span><span class="regexp"> ^</span> /index.php<span class="variable">$uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> <span class="regexp">~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/</span> &#123;</span><br><span class="line">        <span class="title">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">location</span> <span class="regexp">~ ^/(?:\.|autotest|occ|issue|indie|db_|console)</span> &#123;</span><br><span class="line">        <span class="title">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> <span class="regexp">~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\.php(?:$|/)</span> &#123;</span><br><span class="line">        <span class="title">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.*)$</span>;</span><br><span class="line">        <span class="title">include</span> fastcgi_params;</span><br><span class="line">        <span class="title">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="title">fastcgi_param</span> PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line">        <span class="title">fastcgi_param</span> HTTPS <span class="built_in">on</span>;</span><br><span class="line">        <span class="title">fastcgi_param</span> modHeadersAvailable <span class="built_in">true</span>; <span class="comment">#Avoid sending the security headers twice</span></span><br><span class="line">        <span class="title">fastcgi_param</span> front_controller_active <span class="built_in">true</span>;</span><br><span class="line">        <span class="title">fastcgi_pass</span> php-handler;</span><br><span class="line">        <span class="title">fastcgi_intercept_errors</span> <span class="built_in">on</span>;</span><br><span class="line">        <span class="title">fastcgi_request_buffering</span> <span class="built_in">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> <span class="regexp">~ ^/(?:updater|ocs-provider)(?:$|/)</span> &#123;</span><br><span class="line">        <span class="title">try_files</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">        <span class="title">index</span> index.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Adding the cache control header for js and css files</span></span><br><span class="line">    <span class="comment"># Make sure it is BELOW the PHP block</span></span><br><span class="line">    <span class="title">location</span> <span class="regexp">~* \.(?:css|js)$</span> &#123;</span><br><span class="line">        <span class="title">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$uri</span><span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">        <span class="title">add_header</span> Cache-Control <span class="string">"public, max-age=7200"</span>;</span><br><span class="line">        <span class="comment"># Add headers to serve security related headers (It is intended to have those duplicated to the ones above)</span></span><br><span class="line">        <span class="comment"># Before enabling Strict-Transport-Security headers please read into this topic first.</span></span><br><span class="line">        <span class="comment"># add_header Strict-Transport-Security "max-age=15768000; includeSubDomains; preload;";</span></span><br><span class="line">        <span class="title">add_header</span> X-Content-Type-Options nosniff;</span><br><span class="line">        <span class="title">add_header</span> X-Frame-Options <span class="string">"SAMEORIGIN"</span>;</span><br><span class="line">        <span class="title">add_header</span> X-XSS-Protection <span class="string">"1; mode=block"</span>;</span><br><span class="line">        <span class="title">add_header</span> X-Robots-Tag <span class="built_in">none</span>;</span><br><span class="line">        <span class="title">add_header</span> X-Download-Options noopen;</span><br><span class="line">        <span class="title">add_header</span> X-Permitted-Cross-Domain-Policies <span class="built_in">none</span>;</span><br><span class="line">        <span class="comment"># Optional: Don't log access to assets</span></span><br><span class="line">        <span class="title">access_log</span> <span class="built_in">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">location</span> <span class="regexp">~* \.(?:svg|gif|png|html|ttf|woff|ico|jpg|jpeg)$</span> &#123;</span><br><span class="line">        <span class="title">try_files</span> <span class="variable">$uri</span> /index.php<span class="variable">$uri</span><span class="variable">$is_args</span><span class="variable">$args</span>;</span><br><span class="line">        <span class="comment"># Optional: Don't log access to other assets</span></span><br><span class="line">        <span class="title">access_log</span> <span class="built_in">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同时记得开发80和443端口:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">80</span>端口 http</span><br><span class="line">iptables -A INPUT -<span class="tag">p</span> tcp -m tcp --sport <span class="number">80</span> -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -<span class="tag">p</span> tcp -m tcp --dport <span class="number">80</span> -j ACCEPT </span><br><span class="line"><span class="hexcolor">#443</span>端口 https,ssl</span><br><span class="line">iptables -A INPUT -<span class="tag">p</span> tcp -m tcp --sport <span class="number">443</span> -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -<span class="tag">p</span> tcp -m tcp --dport <span class="number">443</span> -j ACCEPT</span><br></pre></td></tr></table></figure></p>
<p>当然,如果不想那么烦,可以 将防火墙关闭(但这样很危险)<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">stop</span>  iptables.service</span><br></pre></td></tr></table></figure></p>
<p>在浏览器打开地址安装:</p>
<p><img src="/images/owncloud_install.png" alt="安装"></p>
<p>数据选择有两种,SQLite||Mysql,其中sqlite比较省服务器资源,但对于访问量比较多的情况下,建议还是使用mysql咯</p>
</div><a data-url="http://b.miaoxiaohei.com/2016/07/27/使用ownCloud搭建云盘/" data-id="cit88wh88000gcmgodcasuhzx" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/07/29/路由宝刷机pandorabox后利用自带存储卡/" class="pre"><i class="fa fa-caret-left"> 路由宝刷机pandorabox后利用自带存储卡</i></a><a href="/2016/07/27/编译安装libiconv库/" class="next">编译安装libiconv库 <i class="fa fa-caret-right"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'cayleyblogs';
var disqus_identifier = '2016/07/27/使用ownCloud搭建云盘/';
var disqus_title = '使用ownCloud搭建云盘';
var disqus_url = 'http://b.miaoxiaohei.com/2016/07/27/使用ownCloud搭建云盘/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//cayleyblogs.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://b.miaoxiaohei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/liunx/">liunx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/科学上网/" style="font-size: 15px;">科学上网</a> <a href="/tags/libiconv/" style="font-size: 15px;">libiconv</a> <a href="/tags/yum/" style="font-size: 15px;">yum</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/composer/" style="font-size: 15px;">composer</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/PhantomJS总结/">PhantomJS总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/优雅的终端/">优雅的终端</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/07/php设计模式-委托/">php设计模式-委托</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-装饰器/">php设计模式-装饰器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-数据访问对象模式/">php设计模式-数据访问对象模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-建造者/">php设计模式-建造者</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-适配器/">php设计模式-适配器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式学习总结/">php设计模式学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/31/CocoaPods-IOS的类库管理工具/">CocoaPods->IOS的类库管理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/字符编码总结/">字符编码总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//cayleyblogs.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">凯旋.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/share.js?v=0.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>