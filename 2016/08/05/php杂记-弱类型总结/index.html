<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录前进的脚步"><title>php杂记-弱类型总结 | 凯旋</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">php杂记-弱类型总结</h1><a id="logo" href="/.">凯旋</a><p class="description">cayley的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">php杂记-弱类型总结</h1><div class="post-meta"><i class="fa fa-calendar"> 2016-08-05</i></div><span data-disqus-identifier="2016/08/05/php杂记-弱类型总结/" class="disqus-comment-count"></span><div class="post-content"><p>php是个弱类型的语言,这是众所周知的事情,所谓的弱类型就是php不严格检查变量的类型.<br>PHP 支持 8 种原始数据类型。<br>四种标量类型：<br>boolean（布尔型）<br>integer（整型）<br>float（浮点型，也称作 double)<br>string（字符串）<br>两种复合类型：<br>array（数组）<br>object（对象）<br>最后是两种特殊类型：<br>resource（资源）<br>NULL（无类型）</p>
<p>在验证变量类型的时候,可以使用var<em>dump()|| gettype()php内置函数,开查看.或者使用is</em>{type}函数(is_int(),is_string(),is_array(),is_object())来判断</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$var</span> = <span class="number">1</span>;</span><br><span class="line">var_dump(<span class="variable">$var</span>);</span><br><span class="line"><span class="variable">$var</span> = <span class="number">1.11</span>;</span><br><span class="line">var_dump(<span class="variable">$var</span>);</span><br><span class="line"><span class="variable">$var</span> = <span class="keyword">array</span>();</span><br><span class="line">var_dump(<span class="variable">$var</span>);</span><br><span class="line"><span class="variable">$var</span> = <span class="string">"string"</span>;</span><br><span class="line">var_dump(<span class="variable">$var</span>);</span><br><span class="line"><span class="variable">$var</span> = new stdClass();</span><br><span class="line">var_dump(<span class="variable">$var</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>看下执行结果:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">huangchengkaideMacBook-Air:www kai$ php test.<span class="function">php </span><br><span class="line"><span class="title">int</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line"><span class="title">array</span><span class="params">(<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">string</span>(<span class="number">6</span>) <span class="string">"string"</span></span><br><span class="line">huangchengkaideMacBook-Air:www kai$ </span><br><span class="line">huangchengkaideMacBook-Air:www kai$ </span><br><span class="line">huangchengkaideMacBook-Air:www kai$ php test.<span class="function">php </span><br><span class="line"><span class="title">int</span><span class="params">(<span class="number">1</span>)</span></span><br><span class="line"><span class="title">float</span><span class="params">(<span class="number">1.11</span>)</span></span><br><span class="line"><span class="title">array</span><span class="params">(<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">string</span>(<span class="number">6</span>) <span class="string">"string"</span></span><br><span class="line">object(stdClass)<span class="preprocessor">#<span class="number">1</span> (<span class="number">0</span>) &#123;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>弱类型的语言对变量的数据类型没有限制，所以我们可以在任何地时候将变量赋值给任意的其他类型的变量，同时变量也可以转换成任意地其他类型的数据。</p>
<p>php怎样实现弱类型的呢?<br>php是c语言来实现,我们现在看下zend引擎,中类型定义文件 zend_types.h (php7)<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="class"><span class="keyword">struct</span> <span class="title">_zval_struct</span>     <span class="title">zval</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">_zval_struct</span> &#123;</span></span><br><span class="line">        zend_value        value;                        <span class="regexp">/* value */</span></span><br><span class="line">        <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">                <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">                        <span class="constant">ZEND_ENDIAN_LOHI_4</span>(</span><br><span class="line">                                zend_uchar    <span class="keyword">type</span>,                     <span class="regexp">/* active type */</span></span><br><span class="line">                                zend_uchar    type_flags,</span><br><span class="line">                                zend_uchar    const_flags,</span><br><span class="line">                                zend_uchar    reserved)     /* call info <span class="keyword">for</span> <span class="constant">EX</span>(<span class="constant">This</span>) *<span class="regexp">/</span><br><span class="line">                &#125; v;</span><br><span class="line">                uint32_t type_info;</span><br><span class="line">        &#125; u1;</span><br><span class="line">        union &#123;</span><br><span class="line">                uint32_t     var_flags;</span><br><span class="line">                uint32_t     next;                 /</span>* hash collision chain *<span class="regexp">/</span><br><span class="line">                uint32_t     cache_slot;           /</span>* literal cache slot *<span class="regexp">/</span><br><span class="line">                uint32_t     lineno;               /</span>* line number (<span class="keyword">for</span> ast nodes) *<span class="regexp">/</span><br><span class="line">                uint32_t     num_args;             /</span>* arguments number <span class="keyword">for</span> <span class="constant">EX</span>(<span class="constant">This</span>) *<span class="regexp">/</span><br><span class="line">                uint32_t     fe_pos;               /</span>* foreach position *<span class="regexp">/</span><br><span class="line">                uint32_t     fe_iter_idx;          /</span>* foreach iterator index *<span class="regexp">/</span><br><span class="line">        &#125; u2;</span><br><span class="line">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<p>通过类型定义的代码,可以知道,php所有的变量结果都是用zval结构体来保存的,而zaval结果体中的zend_value结构体又是真正保存数据的</p>
<p>现在继续看下zend_value结构体</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">typedef union _zend_value &#123;</span><br><span class="line">        zend_long         lval<span class="comment">;                         /* long value */</span></span><br><span class="line">        double            dval<span class="comment">;                         /* double value */</span></span><br><span class="line">        zend_refcounted  *counted<span class="comment">;</span></span><br><span class="line">        zend_string      *str<span class="comment">;</span></span><br><span class="line">        zend_array       *arr<span class="comment">;</span></span><br><span class="line">        zend_object      *obj<span class="comment">;</span></span><br><span class="line">        zend_resource    *res<span class="comment">;</span></span><br><span class="line">        zend_reference   *ref<span class="comment">;</span></span><br><span class="line">        zend_ast_ref     *ast<span class="comment">;</span></span><br><span class="line">        zval             *zv<span class="comment">;</span></span><br><span class="line">        void             *ptr<span class="comment">;</span></span><br><span class="line">        zend_class_entry *ce<span class="comment">;</span></span><br><span class="line">        zend_function    *func<span class="comment">;</span></span><br><span class="line">        struct &#123;</span><br><span class="line">                uint32_t w1<span class="comment">;</span></span><br><span class="line">                uint32_t w2<span class="comment">;</span></span><br><span class="line">        &#125; ww<span class="comment">;</span></span><br><span class="line">&#125; zend_value<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>zend_value是一个联合体。对于小于64位的简单类型，会直接存储值。对于其他比较复杂的类型，如字符串，数组，对象等，是存储的指针。这样，对于简单类型来说，变得简单高效</p>
<p>引发的问题:</p>
<p>1.类型装换问题<br>自动类型转换:<br>FALSE 会转为0，TRUE 会转为 1<br>1)如果该字符串没有包含 ‘.’，’e’ 或 ‘E’ 并且其数字值在整型的范围之内（由 PHP_INT_MAX 所定义），该字符串将被当成 integer 来取值。其它所有情况下都被作为 float 来取值<br>2)该字符串的开始部分决定了它的值。如果该字符串以合法的数值开始，则使用该数值。否则其值为 0（零）。合法数值由可选的正负号，后面跟着一个或多个数字（可能有小数点），再跟着可选的指数部分。指数部分由 ‘e’ 或 ‘E’ 后面跟着一个或多个数字构成。<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$foo</span> = <span class="string">"0"</span>;  // <span class="variable">$foo</span> 是字符串 (ASCII <span class="number">48</span>)</span><br><span class="line"><span class="variable">$foo</span> += <span class="number">2</span>;   // <span class="variable">$foo</span> 现在是一个整数 (<span class="number">2</span>)</span><br><span class="line"><span class="variable">$foo</span> = <span class="variable">$foo</span> + <span class="number">1.3</span>;  // <span class="variable">$foo</span> 现在是一个浮点数 (<span class="number">3.3</span>)</span><br><span class="line"><span class="variable">$foo</span> = <span class="number">5</span> + <span class="string">"10 Little Piggies"</span>; // <span class="variable">$foo</span> 是整数 (<span class="number">15</span>)</span><br><span class="line"><span class="variable">$foo</span> = <span class="number">5</span> + <span class="string">"10 Small Pigs"</span>;     // <span class="variable">$foo</span> 是整数 (<span class="number">15</span>)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>如果要将某类型强制转换为某类型,可以对其使用强制类型转换||settype()函数<br>强制转换:<br>(bool), (boolean) - 转换为布尔类型 boolean:</p>
<p>当转换为 boolean 时，以下值被认为是 FALSE：<br>布尔值 FALSE 本身<br>整型值 0（零）<br>浮点型值 0.0（零）<br>空字符串，以及字符串 “0”<br>不包括任何元素的数组<br>特殊类型 NULL（包括尚未赋值的变量）<br>从空标记生成的 SimpleXML 对象</p>
<p>当转换为 boolean 时,-1 和其它非零值（不论正负）一样，被认为是 TRUE<br>所有其它值都被认为是 TRUE（包括任何资源）。<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="string">""</span>);        // <span class="type">bool</span>(<span class="literal">false</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="number">1</span>);         // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) -<span class="number">2</span>);        // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="string">"foo"</span>);     // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="number">2</span>.<span class="number">3</span>e5);     // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) [<span class="number">12</span>]); // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) []);   // <span class="type">bool</span>(<span class="literal">false</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="string">"false"</span>);   // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="string">"0"</span>);   // <span class="type">bool</span>(<span class="literal">false</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) <span class="number">0</span>.<span class="number">0</span>);   // <span class="type">bool</span>(<span class="literal">false</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) null);   // <span class="type">bool</span>(<span class="literal">false</span>)</span><br><span class="line">var_dump((<span class="type">bool</span>) new stdClass());   // <span class="type">bool</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>(int), (integer) - 转换为整形 integer</p>
<p>boolean转换时: FALSE 会转为0，TRUE 会转为 1,<br>浮点型转换时: 会向下取整,不要将未知的分数强制转换为 integer，这样有时会导致不可预料的结果<br>array转换时:空数组会转为 0 ,非空数组转为1<br>string类型转换时:<br>使用强制转换时不会解析’.’，’e’ 或 ‘E’为float类型,而且直接采用该字符串是否已合法的数字开始,则使用该值,否则其值为0;<br>其他类型转换时:会导致未知错误<br><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) <span class="keyword">true</span> ; <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) <span class="keyword">false</span>; <span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) <span class="number">0.1</span>; <span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) <span class="number">1.5</span>; <span class="comment">//1</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) ( (<span class="number">0.1</span>+<span class="number">0.7</span>) * <span class="number">10</span> ); <span class="comment">// 显示 7,其中内部的表示其实是类似 7.9999999999999991118...。</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) []; <span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>) [<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="string">'222'</span>=&gt;<span class="number">11</span>]; <span class="comment">//1</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>)<span class="string">"10.5"</span>;                <span class="comment">// 10 , 10.5被当成浮点数,向下取整为10</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>)<span class="string">"-10.5"</span>;                <span class="comment">// -10 , -10是合法,为-10</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">int</span>)<span class="string">"-1.3e3"</span>;               <span class="comment">// -1,-1是合法的数字</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>(float), (double), (real) - 转换为浮点型 float<br>string转换时:<br>如果该字符串包含 ‘.’，’e’ 或 ‘E’,会当做float来取值 ,而且采用该字符串是否已合法的数字开始,则使用该值,否则其值为0<br>其他的跟转换为int类似<br><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="number">10</span>;                                 <span class="comment">//10</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="string">'10.1'</span>;                            <span class="comment">//10.1</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="string">'-1.3e3'</span>;                          <span class="comment">//-1300</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="string">'-1.3e3abc'</span>;                       <span class="comment">//-1300</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="keyword">true</span>;                              <span class="comment">//1</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) <span class="keyword">false</span>;                             <span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) [];                                <span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>) [<span class="number">1</span>,<span class="number">2</span>];                             <span class="comment">//1</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>(string) - 转换为字符串 string<br>一个值可以通过在其前面加上 (string) 或用 strval() 函数来转变成字符串.<br> boolean 的 TRUE 被转换成 string 的 “1”。Boolean 的 FALSE 被转换成 “”（空字符串）<br> 整数 integer 或浮点数 float 被转换为数字的字面样式的 string<br> 数组 array 总是转换成字符串 “Array”<br> 对象 object 总是被转换成字符串 “Object”,自 PHP 5 起，适当时可以用 __toString 方法<br> 资源 resource 总会被转变成 “Resource id #1” 这种结构的字符串<br> NULL 总是被转变成空字符串<br> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="function">php</span><br><span class="line"><span class="title">echo</span> <span class="params">(<span class="built_in">string</span>)</span> 10</span>;                                <span class="comment">//'10'</span></span><br><span class="line">echo (<span class="built_in">string</span>) <span class="number">10.1</span>;                             <span class="comment">//'10.1'</span></span><br><span class="line">echo (<span class="built_in">string</span>) -<span class="number">1.3e3</span>;                           <span class="comment">//-1300</span></span><br><span class="line">echo (<span class="built_in">string</span>) <span class="number">1.3e3</span>;                <span class="comment">//-1300</span></span><br><span class="line">echo (<span class="built_in">string</span>) <span class="literal">true</span>;                             <span class="comment">//1</span></span><br><span class="line">echo (<span class="built_in">string</span>) <span class="literal">false</span>;                            <span class="comment">//0</span></span><br><span class="line">$arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>];</span><br><span class="line">        echo <span class="string">"&#123;$arr&#125;"</span>;                          <span class="comment">//array</span></span><br><span class="line">       <span class="function">echo <span class="title">strval</span><span class="params">($arr)</span></span>;              <span class="comment">//array</span></span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>(array) - 转换为数组 array<br>对于任意 integer，float，string，boolean 和 resource 类型，如果将一个值转换为数组，将得到一个仅有一个元素的数组，其下标为 0，该元素即为此标量的值。换句话说，(array)$scalarValue 与 array($scalarValue) 完全一样。</p>
<p>如果一个 object 类型转换为 array，则结果为一个数组，其单元为该对象的属性。键名将为成员变量名，不过有几点例外：整数属性不可访问；私有变量前会加上类名作前缀；保护变量前会加上一个 ‘*’ 做前缀。这些前缀的前后都各有一个 NULL 字符。这会导致一些不可预知的行为：</p>
<p>将 NULL 转换为 array 会得到一个空的数组<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="number">1</span>);</span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="number">1.1</span>);</span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="number">1.3e3</span>);</span><br><span class="line">var_dump((<span class="keyword">array</span>) (<span class="keyword">new</span> stdClass()));</span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="string">'is array'</span>);</span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="keyword">null</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$A</span>; <span class="comment">// 输出 '\0A\0A'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$A</span>; <span class="comment">// 输出 '\0B\0A'</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$AA</span>; <span class="comment">// 输出 'AA'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var_dump((<span class="keyword">array</span>) <span class="keyword">new</span> B());</span><br><span class="line"><span class="preprocessor">?&gt;</span></span><br><span class="line">huangchengkaideMacBook-Air:www kai$ php test.php </span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  int(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  float(<span class="number">1.1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  float(<span class="number">1300</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  string(<span class="number">8</span>) <span class="string">"is array"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="string">"BA"</span>]=&gt;</span><br><span class="line">  <span class="keyword">NULL</span></span><br><span class="line">  [<span class="string">"AA"</span>]=&gt;</span><br><span class="line">  <span class="keyword">NULL</span></span><br><span class="line">  [<span class="string">"AA"</span>]=&gt;</span><br><span class="line">  <span class="keyword">NULL</span></span><br><span class="line">&#125;</span><br><span class="line">huangchengkaideMacBook-Air:www kai$</span><br></pre></td></tr></table></figure></p>
<p>有两个键名为 ‘AA’，不过其中一个实际上是 ‘\0A\0A’ </p>
<p>(object) - 转换为对象 object<br>如果将一个对象转换成对象，它将不会有任何变化。如果其它任何类型的值被转换成对象，将会创建一个内置类 stdClass 的实例。如果该值为 NULL，则新的实例为空。数组转换成对象将使键名成为属性名并具有相对应的值。对于任何其它的值，名为 scalar 的成员变量将包含该值。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="variable">$obj</span> = (object) <span class="string">'string'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;scalar.<span class="string">"\n"</span>;  <span class="comment">// 'string'</span></span><br><span class="line"><span class="variable">$obj</span> = (object) <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;scalar.<span class="string">"\n"</span>;  <span class="comment">// 1</span></span><br><span class="line"><span class="variable">$obj</span> = (object) <span class="number">1.1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;scalar.<span class="string">"\n"</span>;  <span class="comment">// 1.1</span></span><br><span class="line"><span class="variable">$obj</span> = (object) <span class="number">1.3e3</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;scalar.<span class="string">"\n"</span>;  <span class="comment">// 1300</span></span><br><span class="line"><span class="variable">$obj</span> = (object) [];</span><br><span class="line">var_dump(<span class="variable">$obj</span>);</span><br><span class="line"><span class="variable">$obj</span> = (object) [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>];</span><br><span class="line">var_dump(<span class="variable">$obj</span>);</span><br><span class="line"><span class="variable">$obj</span> = (object) [<span class="string">'b'</span>=&gt;<span class="number">1</span>,<span class="string">'c'</span>=&gt;<span class="number">2</span>];</span><br><span class="line">var_dump(<span class="variable">$obj</span>);</span><br><span class="line"><span class="preprocessor">?&gt;</span></span><br><span class="line"></span><br><span class="line">huangchengkaideMacBook-Air:www kai$ php test.php </span><br><span class="line"></span><br><span class="line">string</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1.1</span></span><br><span class="line"><span class="number">1300</span></span><br><span class="line">object(stdClass)<span class="comment">#1 (0) &#123;</span></span><br><span class="line">&#125;</span><br><span class="line">object(stdClass)<span class="comment">#2 (4) &#123;</span></span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  int(<span class="number">1</span>)</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  int(<span class="number">2</span>)</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  int(<span class="number">3</span>)</span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  int(<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line">object(stdClass)<span class="comment">#1 (2) &#123;</span></span><br><span class="line">  [<span class="string">"b"</span>]=&gt;</span><br><span class="line">  int(<span class="number">1</span>)</span><br><span class="line">  [<span class="string">"c"</span>]=&gt;</span><br><span class="line">  int(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">huangchengkaideMacBook-Air:www kai$</span><br></pre></td></tr></table></figure></p>
<p>(unset) - 转换为 NULL (PHP 5)<br>特殊的 NULL 值表示一个变量没有值。NULL 类型唯一可能的值就是 NULL。</p>
<p>在下列情况下一个变量被认为是 NULL：</p>
<p>被赋值为 NULL。</p>
<p>尚未被赋值。</p>
<p>被 unset()。</p>
<p>使用 (unset) $var 将一个变量转换为 null 将不会删除该变量或 unset 其值。仅是返回 NULL 值而已。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>以上内容参考自官方文档</p>
<p>2.类型比较</p>
<p>类型比较表的官方文档地址:<br><a href="https://secure.php.net/manual/zh/types.comparisons.php" target="_blank" rel="external">https://secure.php.net/manual/zh/types.comparisons.php</a></p>
<p>特别要注意,有时候比较的时候,会涉及类型转换问题:</p>
<p>松散型(==)和严格型(===)比较问题等<br>&lt;?php</p>
<p>if(0==’0’){ //true<br>    echo ‘true’;<br>} else{<br>    echo ‘false’;<br>}</p>
<p>if(0 == ‘abcdefg’){ //true<br>    echo ‘true’;<br>} else{<br>    echo ‘false’;<br>}</p>
<p>if(0 === ‘abcdefg’){ //true<br>    echo ‘true’;<br>} else{<br>    echo ‘false’;<br>}</p>
<p>if(1 == ‘1abcdef’){ //true<br>    echo ‘true’;<br>} else{<br>    echo ‘false’;<br>}</p>
<p>?&gt;</p>
<p>3.内置函数的参数的松散</p>
<p>md5()</p>
<p>$array1[] = array(<br>    “foo” =&gt; “bar”,<br>    “bar” =&gt; “foo”,<br>);<br>$array2 = array(“foo”, “bar”, “hello”, “world”);<br>var_dump(md5($array1)==var_dump($array2)); //true</p>
<p>PHP手册中的md5()函数的描述是string md5 ( string $str [, bool $raw_output = false ] )，md5()中的需要是一个string类型的参数。但是当你传递一个array时，md5()不会报错，知识会无法正确地求出array的md5值，这样就会导致任意2个array的md5值都会相等。这个md5()的特性在攻防平台中的bypass again同样有考到。</p>
<p>strcmp()</p>
<p>strcmp()函数在PHP官方手册中的描述是int strcmp ( string $str1 , string $str2 ),需要给strcmp()传递2个string类型的参数。如果str1小于str2,返回-1，相等返回0，否则返回1。strcmp函数比较字符串的本质是将两个变量转换为ascii，然后进行减法运算，然后根据运算结果来决定返回值。<br>如果传入给出strcmp()的参数是数字呢？</p>
<p>$array=[1,2,3];<br>var_dump(strcmp($array,’123’)); //null,在某种意义上null也就是相当于false。</p>
<p>strcmp这种特性在攻防平台中的pass check有考到。</p>
<p>switch()</p>
<p>如果switch是数字类型的case的判断时，switch会将其中的参数转换为int类型。如下：</p>
<p>$i =”2abc”;<br>switch ($i) {<br>case 0:<br>case 1:<br>case 2:<br>    echo “i is less than 3 but not negative”;<br>    break;<br>case 3:<br>    echo “i is 3”;<br>}</p>
<p>这个时候程序输出的是i is less than 3 but not negative，是由于switch()函数将$i进行了类型转换，转换结果为2。</p>
<p>in_array()</p>
<p>在PHP手册中，in_array()函数的解释是bool in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] ),如果strict参数没有提供，那么in_array就会使用松散比较来判断$needle是否在$haystack中。当strince的值为true时，in_array()会比较needls的类型和haystack中的类型是否相同。</p>
<p>$array=[0,1,2,’3’];<br>var_dump(in_array(‘abc’, $array));  //true<br>var_dump(in_array(‘1bc’, $array)); //true</p>
<p>可以看到上面的情况返回的都是true,因为’abc’会转换为0，’1bc’转换为1。<br>array_search()与in_array()也是一样的问题。</p>
</div><a data-url="http://b.miaoxiaohei.com/2016/08/05/php杂记-弱类型总结/" data-id="cit88wh9t0017cmgom734y7m9" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/08/15/字符编码总结/" class="pre"><i class="fa fa-caret-left"> 字符编码总结</i></a><a href="/2016/08/04/openwrt上的uhttp的使用与配置/" class="next">openwrt上的uhttp的使用与配置 <i class="fa fa-caret-right"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'cayleyblogs';
var disqus_identifier = '2016/08/05/php杂记-弱类型总结/';
var disqus_title = 'php杂记-弱类型总结';
var disqus_url = 'http://b.miaoxiaohei.com/2016/08/05/php杂记-弱类型总结/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//cayleyblogs.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://b.miaoxiaohei.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/liunx/">liunx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/科学上网/" style="font-size: 15px;">科学上网</a> <a href="/tags/libiconv/" style="font-size: 15px;">libiconv</a> <a href="/tags/yum/" style="font-size: 15px;">yum</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/composer/" style="font-size: 15px;">composer</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/PhantomJS总结/">PhantomJS总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/优雅的终端/">优雅的终端</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/07/php设计模式-委托/">php设计模式-委托</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-装饰器/">php设计模式-装饰器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-数据访问对象模式/">php设计模式-数据访问对象模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-建造者/">php设计模式-建造者</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式-适配器/">php设计模式-适配器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/php设计模式学习总结/">php设计模式学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/31/CocoaPods-IOS的类库管理工具/">CocoaPods->IOS的类库管理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/字符编码总结/">字符编码总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//cayleyblogs.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">凯旋.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/share.js?v=0.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>